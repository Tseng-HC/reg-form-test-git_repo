<!-- é ­é ¸å°ˆç ”æ´»å‹•å ±åç³»çµ± ver1.01 -->
<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é ­é ¸å°ˆç ”æ´»å‹•å ±åè¡¨å–®</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        /* === å…¨åŸŸè®Šæ•¸èˆ‡åŸºç¤è¨­å®š === */
        :root {
            --primary-color: #06c755;
            --bg-color: #f5f5f5;
            --error-color: #e53935;
        }

        /* [é‡è¦è£œé½Š] å…¨åŸŸç›’æ¨¡å‹è¨­å®šï¼šç¢ºä¿ padding ä¸æœƒæ’å¤§å…ƒç´ å¯¬åº¦ (æ›¿ä»£ Tailwind é è¨­è¡Œç‚º) */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        /* [é‡è¦è£œé½Š] åŸºç¤å­—é«”èˆ‡èƒŒæ™¯ (æ›¿ä»£ Tailwind é è¨­å­—é«”) */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            padding: 20px;
            margin: 0;
        }

        /* === å®¹å™¨èˆ‡ç‰ˆé¢ === */
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* ä¸»æ¨™é¡Œæ¨£å¼ */
        .main-title {
            font-size: 30px;
            font-weight: bold;
            text-align: center;
            color: #333;
            margin-top: 10px;
            margin-bottom: 25px;
        }

        /* æ¬¡æ¨™é¡Œæ¨£å¼ */
        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        /* æ©«å¹…åœ–ç‰‡å€å¡Š */
        .banner-container {
            width: 100%;
            margin-bottom: 20px;
        }

        .banner-img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
        }

        /* === è¡¨å–®å…ƒç´  === */
        .form-group {
            margin-bottom: 20px;
        }

        label.section-title {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
            font-size: 1.05em;
            border-left: 4px solid var(--primary-color);
            padding-left: 8px;
        }

        label.section-title::after {
            content: " *";
            color: var(--error-color);
        }

        /* è¼¸å…¥æ¡† */
        input[type="text"],
        input[type="email"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="email"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        /* é¸é …æŒ‰éˆ• (Radio & Checkbox) */
        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .option-label:hover {
            background-color: #f9f9f9;
        }

        .option-label input {
            margin-right: 10px;
            transform: scale(1.2);
        }

        /* === æé†’è¨­å®šå€å¡Š === */
        .remind-settings {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            display: none;
        }

        .remind-sub-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ddd;
        }

        .remind-sub-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
            padding-bottom: 0;
        }

        /* Line é€£çµæŒ‰éˆ• (è¡¨å–®å…§) */
        .connect-btn {
            background-color: #00B900;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 10px;
        }

        .line-status-text {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 14px;
            margin-left: 10px;
        }

        /* === åº•éƒ¨æŒ‰éˆ•å€ === */
        .action-area {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        button.submit-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s;
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(6, 199, 85, 0.3);
        }

        button:disabled {
            background-color: #ccc !important;
            cursor: not-allowed;
            opacity: 0.7;
        }

        #status {
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
            color: #666;
            min-height: 20px;
        }

        /* === å·¥å…·é¡ === */
        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>

    <div class="container" id="formContainer">

        <!-- ç‰ˆæœ¬è™Ÿé¡¯ç¤ºå€å¡Š -->
        <div style="text-align: right; font-size: 12px; color: #aaa; margin-bottom: 0;">
            é ­é ¸å°ˆç ”æ´»å‹•å ±åç³»çµ± ver1.01
        </div>

        <h1 class="main-title">ğŸ“ é ­é ¸å°ˆç ”æ´»å‹•å ±åè¡¨</h1>
        <!-- è¬›åº§æ©«å¹…åœ–ç‰‡ -->
        <div class="banner-container">
            <img src="https://i.duk.tw/xIs9FV.png" alt="è¬›åº§æ©«å¹…" class="banner-img">
        </div>

        <!-- æ´»å‹•å…§å®¹ä»‹ç´¹ (ä¿æŒåŸæ¨£) -->
        <div class="form-group">
            <div
                style="margin-bottom: 10px; font-weight: bold; color: #333; font-size: 1.05em; border-left: 4px solid var(--primary-color); padding-left: 8px;">
                æ´»å‹•å…§å®¹
            </div>
            <div
                style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; line-height: 1.5;">
                <div style="color: #666; font-size: 16px; margin-bottom: 10px;">
                    åå…­å¹´ç¶“é©—å°ˆæ¥­ç‰©ç†æ²»ç™‚å¸«æˆèª²ï¼Œç¾å ´åˆ†æè‚©é ¸åƒµç¡¬ä¾†æºã€å­¸ç¿’è‚©é ¸ç‹€æ³è‡ªæˆ‘æª¢æ¸¬åŠèˆ’ç·©æ–¹æ³•ã€‚<br><br>
                    å…¥å ´ç•¶å¤©é‚„å¯åƒåŠ æŠ½çï¼Œæœ‰æ©Ÿæœƒç²å¾—å°ç¦®ç‰©å“¦ï¼ <br><br>
                    å…è²»å…¥å ´ã€‚åº§ä½æœ‰é™ï¼Œé¡æ»¿ç‚ºæ­¢ã€‚
                </div>
            </div>
        </div>

        <!-- åœ°é» (ä¿æŒåŸæ¨£) -->
        <div class="form-group">
            <div
                style="margin-bottom: 10px; font-weight: bold; color: #333; font-size: 1.05em; border-left: 4px solid var(--primary-color); padding-left: 8px;">
                åœ°é»
            </div>
            <div
                style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; line-height: 1.5;">
                <div style="font-weight: bold; font-size: 1.1em; color: #333; margin-bottom: 4px;">
                    é ­é ¸å°ˆç ”ç‰©ç†æ²»ç™‚æ‰€
                </div>
                <div style="color: #666; font-size: 16px; margin-bottom: 10px;">
                    å°åŒ—å¸‚ä¿¡ç¾©è™æ—è¡—164å··34è™Ÿ1æ¨“
                </div>
                <a href="https://www.google.com/maps/search/?api=1&query=é ­é ¸å°ˆç ”ç‰©ç†æ²»ç™‚æ‰€+å°åŒ—å¸‚ä¿¡ç¾©è™æ—è¡—164å··34è™Ÿ1æ¨“" target="_blank"
                    style="display: inline-flex; align-items: center; color: var(--primary-color); text-decoration: none; font-weight: bold; font-size: 0.9em; border: 1px solid var(--primary-color); padding: 6px 12px; border-radius: 8px;">
                    ğŸ“ é–‹å•Ÿ Google åœ°åœ–
                </a>
            </div>
        </div>


        <form id="mainForm">

            <!-- 1. å ±åæ™‚é–“ -->
            <div class="form-group">
                <label class="section-title">å ±åå ´æ¬¡</label>
                <div class="radio-group">
                    <label class="option-label"><input type="radio" name="session" value="1/14 (ä¸‰) 10:00 - 11:30"
                            required> 1/14 (ä¸‰) 10:00 - 11:30</label>
                    <label class="option-label"><input type="radio" name="session" value="1/19 (ä¸€) 10:00 - 11:30"> 1/19
                        (ä¸€) 10:00 - 11:30</label>
                    <label class="option-label"><input type="radio" name="session" value="1/25 (æ—¥) 10:00 - 11:30"> 1/25
                        (æ—¥) 10:00 - 11:30</label>
                    <label class="option-label"><input type="radio" name="session" value="1/30 (äº”) 10:00 - 11:30"> 1/30
                        (äº”) 10:00 - 11:30</label>
                </div>
            </div>

            <!-- 2. å§“å -->
            <div class="form-group">
                <label class="section-title" for="realName">å§“å</label>
                <input type="text" id="realName" placeholder="è«‹è¼¸å…¥æ‚¨çš„çœŸå¯¦å§“å" required>
            </div>

            <!-- 3. æ€§åˆ¥ -->
            <div class="form-group">
                <label class="section-title">æ€§åˆ¥</label>
                <div class="radio-group" style="flex-direction: row; gap: 20px;">
                    <label class="option-label" style="flex:1"><input type="radio" name="gender" value="ç”·" required>
                        ç”·</label>
                    <label class="option-label" style="flex:1"><input type="radio" name="gender" value="å¥³"> å¥³</label>
                </div>
            </div>

            <!-- 4. å¹´é½¡å€æ®µ -->
            <div class="form-group">
                <label class="section-title">å¹´é½¡å€æ®µ</label>
                <div class="radio-group">
                    <label class="option-label"><input type="radio" name="age" value="20æ­²ä»¥ä¸‹" required> 20æ­²ä»¥ä¸‹</label>
                    <label class="option-label"><input type="radio" name="age" value="21-35æ­²"> 21-35æ­²</label>
                    <label class="option-label"><input type="radio" name="age" value="36-50æ­²"> 36-50æ­²</label>
                    <label class="option-label"><input type="radio" name="age" value="51-65æ­²"> 51-65æ­²</label>
                    <label class="option-label"><input type="radio" name="age" value="65æ­²ä»¥ä¸Š"> 65æ­²ä»¥ä¸Š</label>
                </div>
            </div>

            <!-- 5. å¾å“ªå¾—çŸ¥ -->
            <div class="form-group">
                <label class="section-title">å¾å“ªå¾—çŸ¥ (å¯è¤‡é¸)</label>
                <div class="checkbox-group">
                    <label class="option-label"><input type="checkbox" name="source" value="ç¶²è·¯"> ç¶²è·¯</label>
                    <label class="option-label"><input type="checkbox" name="source" value="è¦ªå‹æ¨è–¦"> è¦ªå‹æ¨è–¦</label>
                    <label class="option-label"><input type="checkbox" name="source" value="å¯¦é«”å‚³å–®æˆ–æµ·å ±"> å¯¦é«”å‚³å–®æˆ–æµ·å ±</label>
                    <label class="option-label"><input type="checkbox" name="source" value="æ²»ç™‚æ‰€ç¾å ´å¾—çŸ¥"> æ²»ç™‚æ‰€ç¾å ´å¾—çŸ¥</label>
                </div>
            </div>

            <!-- 6. æ˜¯å¦æ¥æ”¶æé†’ (New Feature) -->
            <div class="form-group">
                <label class="section-title">æ˜¯å¦æ¥æ”¶æ´»å‹•æé†’</label>
                <div class="radio-group" style="flex-direction: row; gap: 20px;">
                    <label class="option-label" style="flex:1">
                        <input type="radio" name="needRemind" value="æ˜¯" onclick="toggleRemindSection(true)" required> æ˜¯
                    </label>
                    <label class="option-label" style="flex:1">
                        <input type="radio" name="needRemind" value="å¦" onclick="toggleRemindSection(false)"> å¦
                    </label>
                </div>

                <!-- æé†’å­é¸é …å€å¡Š -->
                <div id="remindDetails" class="remind-settings">
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">è«‹é¸æ“‡è‡³å°‘ä¸€ç¨®æé†’æ–¹å¼ï¼š</div>

                    <!-- Line æé†’ -->
                    <div class="remind-sub-item">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="checkLine" onchange="toggleLineInput()">
                            <span style="font-weight: bold; margin-left: 5px;">Line é€šçŸ¥</span>
                        </label>
                        <div id="lineConnectArea" style="margin-top: 10px; display: none;">
                            <button type="button" id="btnLineLogin" class="connect-btn" onclick="handleLineLogin()">
                                é€£çµ Line å¸³è™Ÿ
                            </button>
                            <span id="lineStatusText" class="line-status-text hidden"></span>
                        </div>
                    </div>

                    <!-- Email æé†’ -->
                    <div class="remind-sub-item">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="checkEmail" onchange="toggleEmailInput()">
                            <span style="font-weight: bold; margin-left: 5px;">Email é€šçŸ¥</span>
                        </label>
                        <div id="emailInputArea" style="margin-top: 10px; display: none;">
                            <input type="email" id="emailInput" placeholder="è«‹å¡«å¯«æ‚¨çš„ Email">
                        </div>
                    </div>
                </div>
            </div>

            <!-- åº•éƒ¨æ“ä½œå€ -->
            <div class="action-area">
                <button type="button" id="btnSubmit" class="submit-btn" onclick="handleSubmit()">
                    é€å‡ºå ±å
                </button>
            </div>

        </form>

        <div id="status"></div>
    </div>

    <!-- æˆåŠŸç•«é¢ (é è¨­éš±è—ï¼Œå ±åå®Œæˆæ‰é¡¯ç¤º)-->
    <div id="successView" class="container hidden" style="text-align: center; padding: 40px 25px;">
        <div style="font-size: 60px; margin-bottom: 10px;">âœ…</div>
        <h2 style="color: var(--primary-color); margin-top: 0;">å ±åæˆåŠŸï¼</h2>
        <p style="color: #666; line-height: 1.6; margin-bottom: 30px;">
            æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„å ±åè³‡è¨Šã€‚<br>
            <span id="remindMsg" style="display:none; color: #ff9800;">å±†æ™‚å°‡æœƒç™¼é€æé†’é€šçŸ¥çµ¦æ‚¨ã€‚</span>
        </p>

        <div style="display: flex; flex-direction: column; gap: 15px; align-items: center;">

            <a href="https://line.me/R/ti/p/@246trduk" target="_blank" style="text-decoration: none;">
                <button style="
                width: 280px;
                background-color: #06c755; 
                color: white; 
                border: none; 
                padding: 14px 0; /* æ”¹ç‚º 14pxï¼Œèˆ‡é€å‡ºæŒ‰éˆ•é«˜åº¦ä¸€è‡´ */
                border-radius: 8px; 
                font-size: 16px; 
                font-weight: bold; 
                cursor: pointer; 
                box-shadow: 0 4px 10px rgba(6, 199, 85, 0.3);
                display: flex; align-items: center; justify-content: center;
            ">
                    <span style="font-size: 1.3em; margin-right: 8px;">ğŸ’¬</span>
                    åŠ å…¥å®˜æ–¹å¸³è™Ÿå¥½å‹
                </button>
            </a>

            <button onclick="liff.closeWindow()" style="
            width: 280px;
            background-color: #f0f0f0; 
            color: #666; 
            border: 1px solid #ddd; 
            padding: 14px 0; /* æ”¹ç‚º 14pxï¼Œèˆ‡ä¸Šæ–¹æŒ‰éˆ•é«˜åº¦ä¸€è‡´ */
            border-radius: 8px; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        ">
                é—œé–‰è¦–çª—
            </button>

        </div>

        <p style="font-size: 12px; color: #aaa; margin-top: 20px;">
            åŠ å…¥å¾Œå¦‚æœ‰ç–‘å•å¯ç›´æ¥å‚³è¨Šè«®è©¢
        </p>
    </div>

    <script>
        // ==========================================
        // [è¨­å®šå€]
        // ==========================================
        const CONFIG = {
            LIFF_ID: "2008806287-9a1hHluF",
            GAS_URL: "https://script.google.com/macros/s/AKfycbx74tnCe5wk-9WXWR-6Nrb8VE1R3iaXq33T6tpitgjk0PCYreNSoilkQ6QSDhghf4jlPQ/exec",
            LINE_OA_ID: "@246trduk"
        };
        // ==========================================

        let userProfile = { userId: "", displayName: "" };
        let isGuest = true;

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = function () {
            if (CONFIG.LIFF_ID) {
                initLiff();
            }
        };

        // 1. åˆå§‹åŒ– LIFF
        async function initLiff() {
            try {
                await liff.init({ liffId: CONFIG.LIFF_ID });

                // æª¢æŸ¥æ˜¯å¦æœ‰æš«å­˜è³‡æ–™ (ç™»å…¥è·³è½‰å›ä¾†)
                restoreFormData();

                if (liff.isLoggedIn()) {
                    isGuest = false;
                    const profile = await liff.getProfile();
                    userProfile.userId = profile.userId;
                    userProfile.displayName = profile.displayName;

                    // æ›´æ–° Line é€£çµç‹€æ…‹é¡¯ç¤º
                    updateLineStatusUI(true);
                } else {
                    isGuest = true;
                    updateLineStatusUI(false);
                }
            } catch (err) {
                console.error('LIFF Init Error:', err);
                document.getElementById('status').innerText = "ç³»çµ±åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†ã€‚";
            }
        }

        // === UI äº’å‹•é‚è¼¯ ===

        // åˆ‡æ›ã€Œæ˜¯å¦æ¥æ”¶æé†’ã€å€åŸŸé¡¯ç¤º
        function toggleRemindSection(show) {
            const div = document.getElementById('remindDetails');
            div.style.display = show ? 'block' : 'none';

            // å¦‚æœåˆ‡æ›æˆã€Œå¦ã€ï¼Œæ¸…ç©ºå­é …ç›®çš„å‹¾é¸èˆ‡è¼¸å…¥ï¼Œé¿å…èª¤åˆ¤
            if (!show) {
                document.getElementById('checkLine').checked = false;
                document.getElementById('checkEmail').checked = false;
                toggleLineInput();
                toggleEmailInput();
            }
        }

        // åˆ‡æ› Line é€£çµæŒ‰éˆ•é¡¯ç¤º
        function toggleLineInput() {
            const isChecked = document.getElementById('checkLine').checked;
            const area = document.getElementById('lineConnectArea');
            area.style.display = isChecked ? 'block' : 'none';
        }

        // åˆ‡æ› Email è¼¸å…¥æ¡†é¡¯ç¤º
        function toggleEmailInput() {
            const isChecked = document.getElementById('checkEmail').checked;
            const area = document.getElementById('emailInputArea');
            area.style.display = isChecked ? 'block' : 'none';

            // èšç„¦è¼¸å…¥æ¡†
            if (isChecked) {
                document.getElementById('emailInput').focus();
            }
        }

        // æ›´æ–° Line ç‹€æ…‹ UI
        function updateLineStatusUI(isLoggedIn) {
            const btn = document.getElementById('btnLineLogin');
            const txt = document.getElementById('lineStatusText');

            if (isLoggedIn) {
                btn.classList.add('hidden');
                txt.classList.remove('hidden');
                txt.innerText = `æ‚¨å¥½ ${userProfile.displayName}ï¼ŒLine å·²é€£çµ`;
            } else {
                btn.classList.remove('hidden');
                txt.classList.add('hidden');
                btn.innerText = "é€£çµ Line å¸³è™Ÿ";
            }
        }

        // è™•ç† Line ç™»å…¥æŒ‰éˆ•
        function handleLineLogin() {
            if (!liff.isLoggedIn()) {
                saveFormData(); // ç™»å…¥å‰æš«å­˜
                liff.login({ redirectUri: window.location.href });
            }
        }

        // === è¡¨å–®é©—è­‰èˆ‡é€å‡º ===

        async function handleSubmit() {
            const form = document.getElementById('mainForm');
            const statusDiv = document.getElementById('status');

            // 1. åŸºæœ¬å¿…å¡«é©—è­‰ (HTML5)
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // 2. ä¾†æºè¤‡é¸é©—è­‰
            const sourceCheckboxes = document.querySelectorAll('input[name="source"]:checked');
            if (sourceCheckboxes.length === 0) {
                alert("è«‹è‡³å°‘é¸æ“‡ä¸€é …ã€Œå¾å“ªå¾—çŸ¥ã€");
                return;
            }

            // 3. æé†’é‚è¼¯é©—è­‰
            const needRemind = document.querySelector('input[name="needRemind"]:checked').value;
            const checkLine = document.getElementById('checkLine').checked;
            const checkEmail = document.getElementById('checkEmail').checked;
            const emailVal = document.getElementById('emailInput').value.trim();

            if (needRemind === "æ˜¯") {
                // å¿…é ˆè‡³å°‘å‹¾é¸ä¸€ç¨®
                if (!checkLine && !checkEmail) {
                    alert("æ¥æ”¶æé†’éœ€è‡³å°‘å‹¾é¸ Line æˆ– Email å…¶ä¸­ä¸€ç¨®æ–¹å¼å–”ï¼");
                    return;
                }

                // é©—è­‰ Line
                if (checkLine && isGuest) {
                    alert("Line é€šçŸ¥æé†’ï¼Œè«‹é»æ“Šã€Œé€£çµ Line å¸³è™Ÿã€æŒ‰éˆ•ä¸¦å®Œæˆç™»å…¥æˆæ¬Šã€‚");
                    return;
                }

                // é©—è­‰ Email
                if (checkEmail && !emailVal) {
                    alert("Email é€šçŸ¥ï¼Œè«‹ç¢ºå¯¦å¡«å¯« Email æ¬„ä½ã€‚");
                    document.getElementById('emailInput').focus();
                    return;
                }
            }

            // === é©—è­‰é€šéï¼Œæº–å‚™è³‡æ–™ ===
            const btnSubmit = document.getElementById('btnSubmit');
            btnSubmit.disabled = true;
            btnSubmit.innerText = "è³‡æ–™å‚³é€ä¸­...";

            // æ”¶é›†è³‡æ–™
            const session = document.querySelector('input[name="session"]:checked').value;

            // è¨ˆç®—æé†’æ—¥æœŸ (å¦‚æœæ˜¯)
            let remindDate = "";
            if (needRemind === "æ˜¯") {
                const dateMatch = session.match(/(\d+)\/(\d+)/);
                if (dateMatch) {
                    const year = new Date().getFullYear();
                    remindDate = `${year}-${dateMatch[1].padStart(2, '0')}-${dateMatch[2].padStart(2, '0')}`;
                }
            }

            // [ä¿®æ”¹] èª¿æ•´é€å‡ºçµæ§‹
            const payload = {
                uid: isGuest ? "guest" : userProfile.userId,
                lineName: isGuest ? "" : userProfile.displayName,
                realName: document.getElementById('realName').value,
                session: session,
                gender: document.querySelector('input[name="gender"]:checked').value,
                age: document.querySelector('input[name="age"]:checked').value,
                source: Array.from(sourceCheckboxes).map(cb => cb.value).join(', '),

                // === ä¿®æ”¹å€æ®µé–‹å§‹ ===
                // ç¬¬9æ¬„: Lineæé†’ (æ˜¯/å¦)
                lineRemind: (needRemind === "æ˜¯" && checkLine) ? "æ˜¯" : "å¦",
                // ç¬¬10æ¬„: Email
                email: emailVal,
                // ç¬¬11æ¬„: Emailæé†’ (æ˜¯/å¦)
                emailRemind: (needRemind === "æ˜¯" && checkEmail) ? "æ˜¯" : "å¦",
                // === ä¿®æ”¹å€æ®µçµæŸ ===

                remindDate: remindDate
            };

            // === é€å‡ºè‡³ GAS ===
            try {
                await fetch(CONFIG.GAS_URL, {
                    method: "POST",
                    body: JSON.stringify(payload),
                    mode: "no-cors",
                    headers: { "Content-Type": "application/json" }
                });

                // é¡¯ç¤ºæˆåŠŸç•«é¢
                localStorage.removeItem('liff_form_temp'); // æ¸…é™¤æš«å­˜
                document.getElementById('formContainer').style.display = 'none';
                document.getElementById('successView').classList.remove('hidden');

                if (needRemind === "æ˜¯") {
                    document.getElementById('remindMsg').style.display = 'inline';
                }

            } catch (error) {
                console.error('Submit Error:', error);
                statusDiv.textContent = "âŒ å‚³é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦";
                statusDiv.style.color = "red";
                btnSubmit.disabled = false;
                btnSubmit.innerText = "é€å‡ºå ±å";
            }
        }

        // === æš«å­˜èˆ‡é‚„åŸ (è™•ç† Line ç™»å…¥è·³è½‰) ===
        function saveFormData() {
            const formData = {
                realName: document.getElementById('realName').value,
                email: document.getElementById('emailInput').value,
                checkLine: document.getElementById('checkLine').checked,
                checkEmail: document.getElementById('checkEmail').checked,
                needRemind: document.querySelector('input[name="needRemind"]:checked')?.value
            };

            // å–®é¸èˆ‡è¤‡é¸
            ['session', 'gender', 'age'].forEach(name => {
                const el = document.querySelector(`input[name="${name}"]:checked`);
                if (el) formData[name] = el.value;
            });

            const sources = [];
            document.querySelectorAll(`input[name="source"]:checked`).forEach(cb => sources.push(cb.value));
            formData.source = sources;

            localStorage.setItem('liff_form_temp', JSON.stringify(formData));
        }

        function restoreFormData() {
            const saved = localStorage.getItem('liff_form_temp');
            if (!saved) return;

            try {
                const data = JSON.parse(saved);

                if (data.realName) document.getElementById('realName').value = data.realName;
                if (data.email) document.getElementById('emailInput').value = data.email;

                // é‚„åŸå–®é¸
                ['session', 'gender', 'age', 'needRemind'].forEach(name => {
                    if (data[name]) {
                        const el = document.querySelector(`input[name="${name}"][value="${data[name]}"]`);
                        if (el) el.click(); // ä½¿ç”¨ click è§¸ç™¼ onclick äº‹ä»¶ (é‡è¦ï¼šè§¸ç™¼ UI åˆ‡æ›)
                    }
                });

                // é‚„åŸè¤‡é¸
                if (data.source) {
                    data.source.forEach(val => {
                        const el = document.querySelector(`input[name="source"][value="${val}"]`);
                        if (el) el.checked = true;
                    });
                }

                // é‚„åŸæé†’å‹¾é¸ (éœ€å…ˆç¢ºèª needRemind å·²å±•é–‹)
                if (data.needRemind === "æ˜¯") {
                    if (data.checkLine) {
                        document.getElementById('checkLine').click(); // è§¸ç™¼ UI é¡¯ç¤º
                        document.getElementById('checkLine').checked = true;
                    }
                    if (data.checkEmail) {
                        document.getElementById('checkEmail').click();
                        document.getElementById('checkEmail').checked = true;
                        // è‹¥æœ‰å€¼å†å¡«å›
                        if (data.email) document.getElementById('emailInput').value = data.email;
                    }
                }

            } catch (e) {
                console.error("Restore Error", e);
            }
        }
    </script>
</body>

</html>