<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>活動報名表單</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- LINE LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
        :root {
            --primary-color: #06c755;
            --bg-color: #f5f5f5;
            --btn-guest-color: #6c757d;
            --error-color: #e53935;
        }

        /* 全域盒模型設定 */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em !important;
            font-weight: bold !important;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label.section-title {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
            font-size: 1.05em;
            border-left: 4px solid var(--primary-color);
            padding-left: 8px;
        }

        input[type="text"],
        input[type="email"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="email"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .option-label:hover {
            background-color: #f9f9f9;
        }

        .option-label input {
            margin-right: 10px;
            transform: scale(1.2);
        }

        /* 提醒設定區塊樣式 */
        .remind-settings {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            display: none;
        }

        .remind-sub-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ddd;
        }

        .remind-sub-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
            padding-bottom: 0;
        }

        .connect-btn {
            background-color: #00B900;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 10px;
        }

        .line-status-text {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 14px;
            margin-left: 10px;
        }

        /* 底部按鈕區 */
        .action-area {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        button.submit-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s;
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(6, 199, 85, 0.3);
        }

        button:disabled {
            background-color: #ccc !important;
            cursor: not-allowed;
            opacity: 0.7;
        }

        #status {
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
            color: #666;
            min-height: 20px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>

    <div class="container" id="formContainer">
        <!-- 表單將由 JavaScript 動態渲染 -->
        <div style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 40px; margin-bottom: 20px;">⏳</div>
            <p style="color: #666;">載入中...</p>
        </div>
    </div>

    <!-- 成功畫面 (預設隱藏，內容由 JS 動態生成) -->
    <div id="successView" class="container hidden" style="text-align: center; padding: 40px 20px;">
        <!-- 內容將由 form-renderer.js 動態生成 -->
    </div>

    <!-- 表單渲染引擎 -->
    <script src="configs/form-renderer.js"></script>

    <script>
        // 從 URL 參數取得配置檔名稱或預覽模式
        const urlParams = new URLSearchParams(window.location.search);
        const isPreviewMode = urlParams.get('preview') === 'true';
        const configName = urlParams.get('config') || 'default-config';
        const configUrl = `./configs-export/${configName}.json`;

        // 載入配置並渲染表單
        async function loadAndRender() {
            try {
                let config;

                // 預覽模式:從 localStorage 載入
                if (isPreviewMode) {
                    const previewConfig = localStorage.getItem('preview_config');
                    if (previewConfig) {
                        config = JSON.parse(previewConfig);
                    } else {
                        throw new Error('找不到預覽配置');
                    }
                } else {
                    // 正常模式:從檔案載入
                    const response = await fetch(configUrl);
                    if (!response.ok) {
                        throw new Error(`無法載入配置檔: ${configUrl}`);
                    }
                    config = await response.json();
                }

                // 建立渲染器實例
                const renderer = new FormRenderer(config);

                // 渲染表單
                renderer.render('formContainer');

                // 只在非預覽模式下初始化 LIFF
                if (!isPreviewMode && config.formMeta.liffId) {
                    await renderer.initLiff();
                }

            } catch (error) {
                console.error('載入失敗:', error);
                document.getElementById('formContainer').innerHTML = `
                <div style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 40px; margin-bottom: 20px;">❌</div>
                    <h2 style="color: #e53935;">載入失敗</h2>
                    <p style="color: #666;">
                        無法載入表單配置檔案。<br>
                        <small>${isPreviewMode ? '預覽模式' : '配置檔: ' + configName + '.json'}</small>
                    </p>
                    <button onclick="location.reload()" 
                            style="margin-top: 20px; background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                        重新載入
                    </button>
                </div>
            `;
            }
        }

        // 頁面載入時執行
        window.onload = loadAndRender;
    </script>

</body>

</html>